<div class="card" style="margin-bottom:12px">
  <h3 class="h3" style="margin-bottom:12px">Resumen del Paciente</h3>

  <div *ngIf="loading">Cargando datos...</div>
  <div *ngIf="error" style="color:#d63031">{{ error }}</div>

  <ng-container *ngIf="!loading && !error">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;">
      <!-- seccion problemas -->
      <div class="card">
        <h4 style="margin-bottom:12px;color:#4b5563">Últimos 4 Problemas</h4>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Problema</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let e of evoluciones; let i = index">
                <td>
                  {{ e.problemaTitulo || e.problemaTitulo || e.descripcion || '-' }}
                </td>
                <td>
                  <span
                    [class]="'estado-badge ' + getEstadoClass(e.estadoProblemaNombre || e.estadoProblema || e.estadoNombre)">
                    {{ e.estadoProblemaNombre || e.estadoProblema || e.estadoNombre || '-' }}
                  </span>
                </td>
              </tr>
              <tr *ngIf="(!evoluciones || evoluciones.length === 0)">
                <td colspan="2" style="text-align:center;color:#9ca3af">No hay problemas registrados</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Seccion evoluciones -->
      <div class="card">
        <h4 style="margin-bottom:12px;color:#4b5563">Últimas 4 Evoluciones</h4>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Problema</th>
                <th>Diagnóstico Inicial</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let e of evoluciones">
                <td>{{ e.problemaTitulo || '-' }}</td>
                <td>{{ e.diagnosticoInicial || '-' }}</td>
              </tr>
              <tr *ngIf="evoluciones.length === 0">
                <td colspan="2" style="text-align:center;color:#9ca3af">No hay evoluciones registradas</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Seccion diag def. -->
    <div class="card">
      <h4 style="margin-bottom:12px;color:#4b5563">Últimos 4 Diagnósticos Definitivos</h4>
      <div style="display:grid;gap:12px">
        <div *ngFor="let e of evoluciones; let i = index" style="padding:12px;background:#f9fafb;border-radius:8px">
          <div style="font-weight:600;margin-bottom:8px">{{ e.problemaTitulo || '-' }}</div>
          <div style="color:#6b7280;font-size:14px">
            <strong>Diagnóstico Final:</strong> {{ e.diagnosticoDefinitivo || 'No hay diagnositcos definitivos para este problema' }}
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>